{% extends 'admin/layout.html.twig' %}

{% block title %}Serviços | DuoFilms{% endblock %}
{% block page_title %}Gerenciar Serviços{% endblock %}

{% block content %}
    <div class="flex justify-between items-center mb-6">
        <div class="flex space-x-2">
            <div class="relative">
                <input type="text" id="searchInput" placeholder="Pesquisar..." class="bg-gray-700 border border-gray-600 rounded-md py-2 px-4 pl-10 w-64 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <div class="absolute left-3 top-2.5">
                    <i class="fas fa-search text-gray-400"></i>
                </div>
            </div>

            {% if categories is defined %}
                <select id="categoryFilter" class="bg-gray-700 border border-gray-600 rounded-md py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">Todas categorias</option>
                    {% for category in categories %}
                        <option value="{{ category.name }}">{{ category.name }}</option>
                    {% endfor %}
                </select>
            {% endif %}
        </div>

        <a href="{{ path('app_service_new') }}" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-md flex items-center transition">
            <i class="fas fa-plus mr-2"></i>
            <span>Novo Serviço</span>
        </a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for service in services %}
            <div class="bg-gray-800 rounded-lg shadow-lg overflow-hidden h-full">
                <div class="h-48 overflow-hidden">
                    {% if service.thumbnail %}
                        <img src="{{ asset('uploads/services/' ~ service.thumbnail) }}" alt="{{ service.name }}" class="w-full h-full object-cover">
                    {% else %}
                        <div class="w-full h-full bg-gray-700 flex items-center justify-center">
                            <i class="fas fa-camera text-4xl text-gray-500"></i>
                        </div>
                    {% endif %}

                    {% if service.featured %}
                        <div class="absolute top-2 left-2">
                            <span class="bg-purple-600 text-white text-xs font-bold px-2 py-1 rounded-full">
                                Premium
                            </span>
                        </div>
                    {% endif %}

                    {% if service.isPopular %}
                        <div class="absolute top-2 right-2">
                            <span class="bg-yellow-500 text-black text-xs font-bold px-2 py-1 rounded-full">
                                Mais Popular
                            </span>
                        </div>
                    {% endif %}
                </div>

                <div class="p-6">
                    <h3 class="text-lg font-semibold mb-2 service-name">{{ service.name }}</h3>

                    {% if service.category is defined and service.category %}
                        <p class="text-sm text-gray-400 category-name mb-3">{{ service.category.name }}</p>
                    {% endif %}

                    <p class="text-gray-300 text-sm line-clamp-3 service-description mb-4">
                        {{ service.description|striptags|slice(0, 100) }}{% if service.description|length > 100 %}...{% endif %}
                    </p>

                    {% if service.features|length > 0 %}
                        <div class="border-t border-gray-700 pt-3 mb-4">
                            <p class="text-sm font-medium text-gray-300 mb-2">Inclui:</p>
                            <ul class="space-y-1">
                                {% for feature in service.features|slice(0, 3) %}
                                    <li class="text-sm text-gray-400 flex items-center">
                                        <i class="fas fa-check text-green-500 mr-2 text-xs"></i>
                                        {{ feature.name }}
                                    </li>
                                {% endfor %}

                                {% if service.features|length > 3 %}
                                    <li class="text-sm text-gray-400 italic">
                                        + {{ service.features|length - 3 }} mais...
                                    </li>
                                {% endif %}
                            </ul>
                        </div>
                    {% endif %}

                    <div class="flex justify-end space-x-3">
                        <a href="{{ path('app_service_show', {id: service.id}) }}" class="text-blue-400 hover:text-blue-300">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a href="{{ path('app_service_edit', {id: service.id}) }}" class="text-yellow-400 hover:text-yellow-300">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="#" class="text-red-400 hover:text-red-300"
                           onclick="if(confirm('Tem certeza que deseja eliminar este serviço?')) { document.getElementById('delete-form-{{ service.id }}').submit(); } return false;">
                            <i class="fas fa-trash"></i>
                        </a>
                        <form id="delete-form-{{ service.id }}" action="{{ path('app_service_delete', {id: service.id}) }}" method="post" style="display: none;">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ service.id) }}">
                        </form>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="col-span-full bg-gray-800 rounded-lg shadow-lg p-10 text-center">
                <i class="fas fa-concierge-bell text-5xl text-gray-600 mb-4"></i>
                <p class="text-xl text-gray-400 mb-6">Nenhum serviço encontrado</p>
                <a href="{{ path('app_service_new') }}" class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-md inline-flex items-center transition">
                    <i class="fas fa-plus mr-2"></i>
                    <span>Adicionar primeiro serviço</span>
                </a>
            </div>
        {% endfor %}
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const categoryFilter = document.getElementById('categoryFilter');
            const services = document.querySelectorAll('.bg-gray-800.rounded-lg.shadow-lg.overflow-hidden');

            function filterServices() {
                const searchTerm = searchInput.value.toLowerCase();
                const categoryValue = categoryFilter ? categoryFilter.value.toLowerCase() : '';

                services.forEach(service => {
                    const name = service.querySelector('.service-name')?.textContent.toLowerCase() || '';
                    const description = service.querySelector('.service-description')?.textContent.toLowerCase() || '';
                    const category = service.querySelector('.category-name')?.textContent.toLowerCase() || '';

                    const matchesSearch = name.includes(searchTerm) || description.includes(searchTerm);
                    const matchesCategory = !categoryValue || category === categoryValue;

                    service.style.display = (matchesSearch && matchesCategory) ? '' : 'none';
                });
            }

            if (searchInput) searchInput.addEventListener('keyup', filterServices);
            if (categoryFilter) categoryFilter.addEventListener('change', filterServices);
        });
    </script>
{% endblock %}